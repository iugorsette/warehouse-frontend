<app-success-message *ngIf="createSuccess" [successMessage]="createMessage" />
<app-error-message *ngIf="createError" [errorMessage]="createMessage" />

<mat-toolbar class="flex-between">
  <div>
    <button (click)="handleAddItem()" mat-icon-button color="accent">
      <mat-icon>add</mat-icon>
    </button>
    <span>Transferir Equipamento</span>
  </div>

  <button (click)="handleFilterModal()" mat-icon-button color="primary">
    <mat-icon>filter_list</mat-icon>
  </button>
</mat-toolbar>

<app-modal />

<mat-card *ngIf="filterModal">
  <form [formGroup]="filters">
    <mat-form-field class="item-full-width">
      <mat-label>Filtrar por tipo</mat-label>
      <input matInput placeholder="Ex. Laptop" formControlName="type" />
    </mat-form-field>

    <mat-form-field class="item-full-width">
      <mat-label>Filtrar por Colaborador</mat-label>
      <mat-select
        placeholder="collaborator"
        #singleSelect
        formControlName="collaboratorId"
      >
        <mat-option>
          <ngx-mat-select-search
            [formControl]="collaboratorFilterCtrl"
          ></ngx-mat-select-search>
        </mat-option>
        <mat-option
          *ngFor="let collaborator of filteredCollaborators | async"
          [value]="collaborator.id"
        >
          {{ collaborator.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="item-full-width">
      <mat-label>Filtrar por Equipamento</mat-label>
      <mat-select
        placeholder="equipment"
        #singleSelect
        formControlName="equipmentId"
      >
        <mat-option>
          <ngx-mat-select-search
            [formControl]="equipmentFilterCtrl"
          ></ngx-mat-select-search>
        </mat-option>
        <mat-option
          *ngFor="let equipment of filteredEquipments | async"
          [value]="equipment.id"
        >
          {{ equipment.title }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <div class="flex-end">
      <button mat-raised-button color="warn" (click)="handleClearFilters()">
        Limpar
      </button>
      <button
        mat-raised-button
        color="primary"
        (click)="handleFilters()"
        [disabled]="!filters.valid"
      >
        Filtrar
      </button>
    </div>
  </form>
</mat-card>

<mat-card class="item" *ngFor="let report of reports; let i = index">
  <mat-card-content class="item-full-width">
    <div class="flex-between">
      <mat-card-header class="webkit">
        <div class="report">
          <div>
            <p class="item-title">Item: {{ report.equipment.title }}</p>
            <p class="date">Em: {{ report.createdAt | date : "dd/MM/yyyy" }}</p>
          </div>
          <div>
            <p class="collaborator">
              tipo: {{ report.type }} Colaborador:
              {{
                report?.collaborator?.name
                  ? report.collaborator.name
                  : "Estoque"
              }}
            </p>
            <p>
              Modificado por :
              {{ report?.changeBy?.name ? report.changeBy.name : "" }}
            </p>
          </div>
        </div>
      </mat-card-header>
    </div>
    <mat-divider />
  </mat-card-content>
</mat-card>

<app-paginator [totalItems]="totalItens" (pageChange)="pageChange($event)" />
